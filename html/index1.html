<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link rel="stylesheet" href="./css/base.css">
	<link rel="stylesheet" href="./css/second.css">
</head>
<body>
<div class="top-con">
	<div class="member-left">
		<div class="logo">
			<img src="./images/logo1.png" alt="">
		</div>
		<div class="member-list info1">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info2">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info3">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
	</div>
	<div class="member-right">
		<div class="member-list info4">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info5">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info6">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info7">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
	</div>
</div>

<div class="bottom-con">
	<div class="member-left">
		<div class="member-list info0">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info8">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info9">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info10">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
	</div>
	<div class="member-right">
		<div class="member-list info11">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info12">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info13">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
		<div class="member-list info14">
			<p class="member-name">暂无学员</p>
			<div class="datail-data">
				<span class="percent"><span>0</span><i>%</i></span>
				<div class="data-box">
					<div><img src="images/heart.png" alt="" class="heart-img"><span class="heart">0</span></div>
					<div><img src="images/dot.png" alt="" class="dot-img"><span class="dot">0</span></div>
					<div><img src="images/hot.png" alt="" class="qk-img"><span class="qk">0</span></div>
				</div>
			</div>
			<div class="head-box"><img src="images/head.jpg" alt=""></div>
		</div>
	</div>
</div>

<div class="g-time">
	<div class="t-timing">
		<div id="hour"><span class="time-logo-0"></span><span class="time-logo-0"></span><i>:</i></div>
		<div id="minute"><span class="time-logo-0"></span><span class="time-logo-0"></span><i>:</i></div>
		<div id="second"><span class="time-logo-0"></span><span class="time-logo-0"></span></div>
	</div>
	<div class="process-box">
		<div class="process-line">
		</div>
		<div class="co2-scaling" style="width: 156px; height: 156px;position: absolute; top: -8px; left: -8px;">
			<svg width="156" height="156" version="1.1" xmlns="http://www.w3.org/2000/svg">
				<path id="co2" fill="none" stroke-width="8" stroke="#f9cdff"/>
			</svg>
			<div id="co2-dot"><span class="dot"></span></div>
		</div>
	</div>
	<div class="time-process">
		<p class="date">2018-04-01</p>
		<p class="weekend">MONDAY</p>
	</div>
	<div class="g-rotate">
		<div class="rotate-1"></div>
		<div class="rotate-2"></div>
		<div class="rotate-3"></div>
		<div class="rotate-4"></div>
	</div>
</div>

<div class="g-wave">
	<span class="wave1"></span>
	<span class="wave2"></span>
	<span class="wave3"></span>
	<span class="wave4"></span>
	<span class="wave5"></span>
	<span class="wave6"></span>
	<span class="wave7"></span>
	<span class="wave8"></span>
	<span class="wave9"></span>
 	<span class="wave10"></span>
	<span class="wave11"></span>
	<span class="wave11"></span>
	<span class="wave12"></span>
	<span class="wave13"></span>
	<span class="wave14"></span>
	<span class="wave15"></span>
	<span class="wave16"></span>
</div>
</body>
</html>
<script src="./js/jquery.min.js"></script>
<script src="./js/func.js"></script>
<script>
	$(function ()
	{
		console.log(window.location.href)
		var timer = null;
		var timer1 = null;
//建立连接
		var ws = new WebSocket("ws://192.168.18.11:8181");
//		var ws = new WebSocket("ws://192.168.12.205:8181");
		var nickname = "";
		ws.onopen = function (e)
		{
			console.log('Connection to server opened');

			var netData={
				type:'page',
				pageStatus: 1,
				classType:5
			}
			ws.send(JSON.stringify(netData));
		}

		var count = 0;
		setCo2(count);
		$('.process-line').html(count + '%')

		//收到消息处理
		ws.onmessage = function (e)
		{
			var data = JSON.parse(e.data);
			console.log(data);
			if (data.pageStatus == 1)
			{

				var href = window.location.href.split('/');
				if (href[href.length - 1] != 'index' + data.pageId + '.html')
				{
					window.location.href = 'index' + data.pageId + '.html';
				}
				var h = parseInt(data.totalTime / (60 * 60 * 1000));
				var m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
				var s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
				var ms = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000 - s * 1000) / 100);
				if (data.classType == 0 || data.classType == 2)
				{
					if (data.classType == 2)
					{
						h = parseInt(data.totalTime / (60 * 60 * 1000));
						m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
						s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
						ms = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000 - s * 1000) / 100);
						setTime(h, m, s, ms, 'time-logo-');

						let sd = s * 1000 + m * 60 * 1000 + h * 60 * 60 * 1000;

						setCo2(parseInt(sd / 36000));

						$('.process-line').html(parseInt(sd / 36000) + '%');

					}

					clearInterval(timer);
					timer = setInterval(function ()
					{
						++s == 60 ? (m++, s = 0) : null;
						m == 60 ? (h++, m = 0) : null;
						setTime(h, m, s, ms, 'time-logo-');
						let sd = s * 1000 + m * 60 * 1000 + h * 60 * 60 * 1000;
						if ((sd / 36000) % 1 === 0)
						{
							setCo2(sd / 36000);
							$('.process-line').html(sd / 36000 + '%')
						}
					}, 1000);
				}

				if (data.classType == 1 || data.classType == 3)
				{
					clearInterval(timer);
					clearInterval(timer1);
					if (data.classType == 3)
					{
						h = 0;
						m = 0;
						s = 0;
						ms = 0;
						count = 0;
						if (data.classType == 3)
						{
							setTime(h, m, s, ms, 'time-logo-');
							setCo2(0)
						}
					}
					if (data.classType == 1)
					{
						h = parseInt(data.totalTime / (60 * 60 * 1000));
						m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
						s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
						setTime(h, m, s, ms, 'time-logo-');

						let sd = s * 1000 + m * 60 * 1000 + h * 60 * 60 * 1000;

						setCo2(parseInt(sd / 36000));

						$('.process-line').html(parseInt(sd / 36000) + '%');

					}
				}
			}
			else if (data.pageStatus == 2)
			{
				window.location.href = 'touch' + data.courseId + '.html';
			}
		}

		ws.onclose = function (e)
		{
			console.log("Connection closed");
		}

		//发送消息
		function sendMessage($data)
		{
			ws.send(JSON.stringify({
				value: $data,
				id: 1,
				type: -1
			}));
		}

		function disconnect()
		{
			ws.close();
		}

		$('.time-process .date').html(getTime());
		$(".time-process .weekend").html(getWeek())
		setInterval(function ()
		{
			$('.time-process .date').html(getTime())
			$(".time-process .weekend").html(getWeek())
		}, 1000)

		function setInfo()
		{
			$.ajax({
				url: 'http://test.service.vsprawl.huanwuh5.com/ksms-web-pc/screen/getRecentHeartrates',
				type: 'post',
				datatype: 'json',
				success: function (res)
				{
					var data = JSON.parse(res.data).result.heartrates;
					for (let i = 0; i < data.length; i++)
					{
						let ele = '.stu-info' + i;
						$(ele).css('display', 'block');
						$(ele).children('.member-name').html(data[i].nickname);
						$(ele).children('.percent').find('span').html(data[i].effort);
						$(ele).find('.heart').html(data[i].bpm);
						$(ele).find('.head-box').css('border', '3px solid ' + getPc(data[i].effort));
						$(ele).find('.head-box').find('img').attr('src', data[i].avatar);

						$.ajax({
							url: 'http://test.service.vsprawl.huanwuh5.com/ksms-web-pc/screen/getMoverTodayEffort?moverId=' + data[i].id,
							type: 'post',
							datatype: 'json',
							success: function (res)
							{
								var rs = JSON.parse(res.data).result.today_effort;
								$(ele).find('.dot').html(rs.effort_point);
								$(ele).find('.qk').html(rs.calorie);
							}
						})
					}
				}
			})
		}

		setInfo();
		setInterval(setInfo, 3000)
	})
</script>
