<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link rel="stylesheet" href="./css/base.css">
	<link rel="stylesheet" href="./css/index.css">
</head>
<body>
<div class="container">
	<div class="g-bg">
		<img src="./images/qm1-fade-in.png" alt="">
	</div>
	<div class="top-con">
		<div class="con-rinking">
			<div class="rank-dtl" id="rink">
				<div class="head-ring">
					<img src="./images/head.jpg" alt="" class="head.jpg">
				</div>
			</div>
			<div class="rank-dtl">
				<div class="head-ring">
					<img src="./images/head.jpg" alt="" class="head.jpg">
				</div>
			</div>
			<div class="rank-dtl">
				<div class="head-ring">
					<img src="./images/head.jpg" alt="" class="head.jpg">
				</div>
			</div>
		</div>
		<div class="con-time">
			<div class="t-timing">
				<div id="hour"><span class="time-logo-0"></span><span class="time-logo-0"></span><i>:</i></div>
				<div id="minute"><span class="time-logo-0"></span><span class="time-logo-0"></span><i>:</i></div>
				<div id="second"><span class="time-logo-0"></span><span class="time-logo-0"></span></div>
			</div>
			<div class="t-today"></div>
		</div>
		<div class="stu-info info0">
			<div class="info-base">
				<div class="g-name info-base-name">暂无教练</div>
				<div class="percent">
					<div class="percent-num">
						<span class="per-num1 per-logo0"></span>
						<span class="per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.jpg" alt="">
			</div>
			<div class="info-agm">
				<div class="agm-heart">
					<img src="./images/heart.png">
					<div class="heart">
						0
					</div>
				</div>
				<div class="agm-dot">
					<img src="./images/dot.png">
					<div class="dot">
						0
					</div>
				</div>
				<div class="agm-hot">
					<img src="./images/hot.png">
					<div class="qk">
						0
					</div>
				</div>
			</div>
		</div>
		<div class="con-logo">
			<img src="./images/logo1.png" alt="">
			<img src="./images/logo.png" alt="" class="znd">
		</div>
	</div>
	<div class="bottom-con">
		<div class="bottom-left">
			<div class="stu-info info1">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info2">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info3">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info4">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info9">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info10">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							888
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							899
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info11">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info12">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="bottom-right">
			<div class="stu-info info5">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info6">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info8">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info13">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info15">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
			<div class="stu-info info16">
				<div class="info-base">
					<div class="g-name info-base-name">暂无学员</div>
					<div class="percent">
						<div class="percent-num">
							<span class="per-num1 per-logo0"></span>
							<span class="per-num2 per-logo0"></span>
						</div>
						<i class="percent-logo">%</i>
					</div>
				</div>
				<div class="info-head">
					<img src="./images/head.jpg" alt="">
				</div>
				<div class="info-agm">
					<div class="agm-heart">
						<img src="./images/heart.png">
						<div class="heart">
							0
						</div>
					</div>
					<div class="agm-dot">
						<img src="./images/dot.png">
						<div class="dot">
							0
						</div>
					</div>
					<div class="agm-hot">
						<img src="./images/hot.png">
						<div class="qk">
							0
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</body>
</html>
<script src="./js/jquery.min.js"></script>
<script src="./js/func.js"></script>
<script>
	var timer = null;
	$(function ()
	{
		//建立连接
		var ws = new WebSocket("ws://192.168.18.11:8181");
//		var ws = new WebSocket("ws://192.168.12.205:8181");
		var nickname = "";
		ws.onopen = function (e)
		{
			console.log('Connection to server opened');
			var netData={
				type:'page',
				pageStatus: 1,classType:5
			}
			ws.send(JSON.stringify(netData));
		}
		//收到消息处理
		ws.onmessage = function (e)
		{
			var data = JSON.parse(e.data);
			console.log(data)
			if (data.pageStatus==1)
			{

				var href = window.location.href.split('/');
				if (href[href.length - 1] != 'index' + data.pageId + '.html')
				{
					window.location.href = 'index' + data.pageId + '.html';
				}
				var h = parseInt(data.totalTime / (60 * 60 * 1000));
				var m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
				var s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
				var ms = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000 - s * 1000) / 100);
				if (data.classType == 0 || data.classType == 2)
				{
					clearInterval(timer);
					timer = setInterval(function ()
					{
						++ms == 10 ? (s++ , ms = 0) : null;
						s == 60 ? (m++, s = 0) : null;
						m == 60 ? (h++, m = 0) : null;
						setTime(h, m, s,ms,'time-logo-');
					}, 100);
				}
				else if (data.classType == 1)
				{
					clearInterval(timer);
					clearInterval(timer);
					clearInterval(timer);
					clearInterval(timer);

					if (data.classType == 1)
					{
						h = parseInt(data.totalTime / (60 * 60 * 1000));
						m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
						s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
						setTime(h, m, s, ms, 'time-logo-');
						let sd = s * 1000 + m * 60 * 1000 + h * 60 * 60 * 1000;
					}

				}
				if(data.classType == 3){
					h = 0;
					m = 0;
					s = 0;
					ms = 0;
					setTime(h, m, s,ms,'time-logo-');
				}
			}else if(data.pageStatus==2){
				window.location.href = 'touch' + data.courseId + '.html';
			}
		}

		ws.onclose = function (e)
		{
			console.log("Connection closed");
		}

		//发送消息
		function sendMessage($data)
		{
			ws.send(JSON.stringify({
				value: $data,
				id: 1,
				type: -1
			}));
		}

		function disconnect()
		{
			ws.close();
		}

		/*当前日期*/
		$('.t-today').html(getTime());
		setInterval(function ()
		{
			$('.t-today').html(getTime());
		}, 1000)

		function setInfo()
		{
			$.ajax({
				url: 'http://test.service.vsprawl.huanwuh5.com/ksms-web-pc/screen/getRecentHeartrates',
				type: 'post',
				datatype: 'json',
				success: function (res)
				{
					var data = JSON.parse(res.data).result.heartrates;
					var maxList = [];
					for (var i = 1; i < data.length; i++)
					{
						maxList.push(data[i])
					}
					/*排名*/
					maxList.sort(sortEff)
					for (let i = 0; i < 3 && i < maxList.length; i++)
					{
						$('.rank-dtl').eq(i).find('.head.jpg').attr('src', maxList[i].avatar);
						$('.rank-dtl').eq(i).find('.head-ring').css({
							'border-top': '4px solid ' +
							getPc(maxList[i].effort),
							'border-right': '4px solid ' +
							getPc(maxList[i].effort)
						});
					}

					for (let i = 0; i < data.length; i++)
					{
						let ele = '.info' + i;
						$(ele).css('display', 'block');
						$(ele).find('.g-name').html(data[i].nickname);
						let per = String(data[i].effort).split('')
						console.log(data[i].effort)
						if (per.length > 1)
						{
							$(ele).find('.percent').find('span').eq(0).removeClass().addClass('per-logo' + per[0]);
							$(ele).find('.percent').find('span').eq(1).removeClass().addClass('per-logo' + per[1]);
						}
						else if (per.length == 1)
						{
							$(ele).find('.percent').find('span').eq(1).removeClass().addClass('per-logo' + per[0]);
							$(ele).find('.percent').find('span').eq(0).removeClass().addClass('per-num1');
						}
						else if (per.length == 0)
						{
							$(ele).find('.percent').find('span').eq(0).removeClass().addClass('per-num1');
							$(ele).find('.percent').find('span').eq(1).removeClass().addClass('per-logo0');
						}

						$(ele).find('.heart').html(data[i].bpm);
						$(ele).find('.info-head').css('background-color', getPc(data[i].effort));
						$(ele).find('.info-head').find('img').attr('src', data[i].avatar);

						$.ajax({
							url: 'http://test.service.vsprawl.huanwuh5.com/ksms-web-pc/screen/getMoverTodayEffort?moverId=' + data[i].id,
							type: 'post',
							datatype: 'json',
							success: function (res)
							{
								var rs = JSON.parse(res.data).result.today_effort;
								$(ele).find('.dot').html(rs.effort_point);
								$(ele).find('.qk').html(rs.calorie);
							}
						})
					}
				}
			})
		}

		setInfo();
		setInterval(setInfo, 3000)
	})


</script>