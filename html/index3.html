<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link rel="stylesheet" href="./css/base.css">
	<link rel="stylesheet" href="./css/three.css">
</head>
<body>
<div class="g-time">
	<div class="time-con">
		<div class="time-dtl">
			<div id="hour"><span class="time-logo-0"></span><span class="time-logo-0"></span><i></i></div>
			<div id="minute"><span class="time-logo-0"></span><span class="time-logo-0"></span><i></i></div>
			<div id="second"><span class="time-logo-0"></span><span class="time-logo-0"></span><i></i></div>
			<div id="ms"><span class="time-logo-0"></span><span class="time-logo-0"></span></div>
		</div>
	</div>
	<div class="stu-con">
		<div class="stu-info info0">
			<div class="info-base">
				<div class="info-base-name">暂无学员</div>
				<div class="percent">
					<div class="percent-num">
						<span class="num-1"></span>
						<span class="num-2 per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.png" alt="">
			</div>
			<div class="info-agm">
				<div>
					<img src="./images/heart.png">
					<span class="heart">0</span>
				</div>
				<div>
					<img src="./images/dot.png">
					<span class="dot">0</span>
				</div>
				<div>
					<img src="./images/hot.png" class="hot">
					<span class="qk">0</span>
				</div>
			</div>
		</div>
		<div class="stu-info info1">
			<div class="info-base">
				<div class="info-base-name">暂无学员</div>
				<div class="percent">
					<div class="percent-num">
						<span class="num-1"></span>
						<span class="num-2 per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.png" alt="">
			</div>
			<div class="info-agm">
				<div>
					<img src="./images/heart.png">
					<span class="heart">0</span>
				</div>
				<div>
					<img src="./images/dot.png">
					<span class="dot">0</span>
				</div>
				<div>
					<img src="./images/hot.png" class="hot">
					<span class="qk">0</span>
				</div>
			</div>
		</div>
		<div class="stu-info info2">
			<div class="info-base">
				<div class="info-base-name">暂无学员</div>
				<div class="percent">
					<div class="percent-num">
						<span class="num-1"></span>
						<span class="num-2 per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.png" alt="">
			</div>
			<div class="info-agm">
				<div>
					<img src="./images/heart.png">
					<span class="heart">0</span>
				</div>
				<div>
					<img src="./images/dot.png">
					<span class="dot">0</span>
				</div>
				<div>
					<img src="./images/hot.png" class="hot">
					<span class="qk">0</span>
				</div>
			</div>
		</div>
		<div class="stu-info info3">
			<div class="info-base">
				<div class="info-base-name">暂无学员</div>
				<div class="percent">
					<div class="percent-num">
						<span class="num-1"></span>
						<span class="num-2 per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.png" alt="">
			</div>
			<div class="info-agm">
				<div>
					<img src="./images/heart.png">
					<span class="heart">0</span>
				</div>
				<div>
					<img src="./images/dot.png">
					<span class="dot">0</span>
				</div>
				<div>
					<img src="./images/hot.png" class="hot">
					<span class="qk">0</span>
				</div>
			</div>
		</div>
		<div class="stu-info info4">
			<div class="info-base">
				<div class="info-base-name">暂无学员</div>
				<div class="percent">
					<div class="percent-num">
						<span class="num-1"></span>
						<span class="num-2 per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.png" alt="">
			</div>
			<div class="info-agm">
				<div>
					<img src="./images/heart.png">
					<span class="heart">0</span>
				</div>
				<div>
					<img src="./images/dot.png">
					<span class="dot">0</span>
				</div>
				<div>
					<img src="./images/hot.png" class="hot">
					<span class="qk">0</span>
				</div>
			</div>
		</div>
		<div class="stu-info info5">
			<div class="info-base">
				<div class="info-base-name">暂无学员</div>
				<div class="percent">
					<div class="percent-num">
						<span class="num-1"></span>
						<span class="num-2 per-logo0"></span>
					</div>
					<i class="percent-logo">%</i>
				</div>
			</div>
			<div class="info-head">
				<img src="./images/head.png" alt="">
			</div>
			<div class="info-agm">
				<div>
					<img src="./images/heart.png">
					<span class="heart">0</span>
				</div>
				<div>
					<img src="./images/dot.png">
					<span class="dot">0</span>
				</div>
				<div>
					<img src="./images/hot.png" class="hot">
					<span class="qk">0</span>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="g-video"></div>
<div class="g-stu">
	<div class="stu-info info6">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info7">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info8">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info9">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info10">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info11">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info12">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info13">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info14">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info15">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info16">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
	<div class="stu-info info17">
		<div class="info-base">
			<div class="info-base-name">暂无学员</div>
			<div class="percent">
				<div class="percent-num">
					<span class="num-1"></span>
					<span class="num-2 per-logo0"></span>
				</div>
				<i class="percent-logo">%</i>
			</div>
		</div>
		<div class="info-head">
			<img src="./images/head.png" alt="">
		</div>
		<div class="info-agm">
			<div>
				<img src="./images/heart.png">
				<span class="heart">0</span>
			</div>
			<div>
				<img src="./images/dot.png">
				<span class="dot">0</span>
			</div>
			<div>
				<img src="./images/hot.png" class="hot">
				<span class="qk">0</span>
			</div>
		</div>
	</div>
</div>
</body>
</html>
<script src="./js/jquery.min.js"></script>
<script src="./js/func.js"></script>
<script>
	$(function ()
	{
		var timer = null;
		var timer1 = null;
//建立连接
		var ws = new WebSocket("ws://192.168.18.11:8181");
//		var ws = new WebSocket("ws://192.168.12.205:8181");
		var nickname = "";
		ws.onopen = function (e)
		{
			console.log('Connection to server opened');
			var netData = {
				type: 'page',
				pageStatus: 1,
				classType: 5
			}
			ws.send(JSON.stringify(netData));
		}

		var count = 0;

		//收到消息处理
		ws.onmessage = function (e)
		{
			var data = JSON.parse(e.data);
			if (data.pageStatus == 1)
			{
				console.log(data);
				var href = window.location.href.split('/');
				if (href[href.length - 1] != 'index' + data.pageId + '.html')
				{
					window.location.href = 'index' + data.pageId + '.html';
				}
				var h = parseInt(data.totalTime / (60 * 60 * 1000));
				var m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
				var s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
				var ms = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000 - s * 1000) / 100);
				if (data.classType == 0 || data.classType == 2)
				{
					clearInterval(timer);
					if (data.classType == 2)
					{
						h = parseInt(data.totalTime / (60 * 60 * 1000));
						m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
						s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
						ms = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000 - s * 1000) / 100);
						setTime(h, m, s, ms, 'time-logo-');
					}
					timer = setInterval(function ()
					{
						++ms == 100 ? (s++, ms = 0) : null;
						s == 60 ? (m++, s = 0) : null;
						m == 60 ? (h++, m = 0) : null;
						setTime(h, m, s, ms, 'time-logo-');
					}, 10);
				}

				if (data.classType == 1)
				{
					clearInterval(timer);
					h = parseInt(data.totalTime / (60 * 60 * 1000));
					m = parseInt((data.totalTime - h * 60 * 60 * 1000) / (60 * 1000));
					s = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000) / 1000);
					ms = parseInt((data.totalTime - h * 60 * 60 * 1000 - m * 60 * 1000 - s * 1000) / 100);
					setTime(h, m, s, ms, 'time-logo-');
				}
				if (data.classType == 3)
				{
					clearInterval(timer);
					h = 0;
					m = 0;
					s = 0;
					ms = 0;
					count = 0;
					setTime(h, m, s, ms, 'time-logo-');
				}
			}
			else if (data.pageStatus == 2)
			{
				window.location.href = 'touch' + data.courseId + '.html';
			}
		}

		ws.onclose = function (e)
		{
			console.log("Connection closed");
		}

		//发送消息
		function sendMessage($data)
		{
			ws.send(JSON.stringify({
				value: $data,
				id: 1,
				type: -1
			}));
		}

		function disconnect()
		{
			ws.close();
		}

		function setInfo()
		{
			$.ajax({
				url: 'http://test.service.vsprawl.huanwuh5.com/ksms-web-pc/screen/getRecentHeartrates',
				type: 'post',
				datatype: 'json',
				success: function (res)
				{
					var data = JSON.parse(res.data).result.heartrates;
					for (let i = 0; i < data.length; i++)
					{
						let ele = '.info' + i;
						$(ele).css('display', 'block');
						$(ele).find('.info-base-name').html(data[i].nickname);
						let per = String(data[i].effort).split('')
						if (per.length > 1)
						{
							$(ele).find('.percent').find('span').eq(0).removeClass().addClass('per-logo' + per[0]);
							$(ele).find('.percent').find('span').eq(1).removeClass().addClass('per-logo' + per[1]);
						}
						else if (per.length == 1)
						{
							$(ele).find('.percent').find('span').eq(1).removeClass().addClass('per-logo' + per[0]);
							$(ele).find('.percent').find('span').eq(0).removeClass().addClass('per-num1');
						}
						else if (per.length == 0)
						{
							$(ele).find('.percent').find('span').eq(0).removeClass().addClass('per-num1');
							$(ele).find('.percent').find('span').eq(1).removeClass().addClass('per-logo0');
						}

						$(ele).find('.heart').html(data[i].bpm);
						$(ele).find('.info-head').css('background-color', getPc(data[i].effort));
						$(ele).find('.info-head').find('img').attr('src', data[i].avatar);

						$.ajax({
							url: 'http://test.service.vsprawl.huanwuh5.com/ksms-web-pc/screen/getMoverTodayEffort?moverId=' + data[i].id,
							type: 'post',
							datatype: 'json',
							success: function (res)
							{
								var rs = JSON.parse(res.data).result.today_effort;
								$(ele).find('.dot').html(rs.effort_point);
								$(ele).find('.qk').html(rs.calorie);
							}
						})
					}
				}
			})
		}
		setInfo();
		setInterval(setInfo, 3000)
	})
</script>